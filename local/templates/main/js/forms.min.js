(function($){$.fn.validateForm=function(options){var settings=$.extend({success:null,error:null},options);var $form=$(this);var methods={masks:function(){$form.on('focus','[type=tel]',function(){$(this).inputmask({mask:'+9 (999) 999-99-99',clearMaskOnLostFocus:true});}).on('focus','[type=date]',function(){$(this).inputmask({mask:'99.99.9999',clearMaskOnLostFocus:true});});}};$('form[name='+this.attr('name')+']').each(function(){var $form=$(this);methods.masks();$form.validate({focusInvalid:true,onkeyup:false,ignore:[],highlight:function(element,errorClass){if($(element).is('[name=rules]')){$(element).parent().addClass('error');}else{$(element).addClass('error');}},unhighlight:function(element,errorClass){if($(element).is('[name=rules]')){$(element).parent().removeClass('error');}else{$(element).removeClass('error');}},errorPlacement:function(error,element){return false;},submitHandler:function(form){var $form=$(form);var $form_id=$form.find('[name="WEB_FORM_ID"]').val();$form.find('[type="submit"]').prop('disabled',true).addClass('loading');setFieldNames($form);window['checkFields_'+$form_id]($form);sendForm(new FormData($form[0]));}});function sendForm(data){$form.find('.error').removeClass('error');$form.find('[type=submit]').prop('disabled',true);$.ajax({url:$form.attr('action'),type:'POST',data:data,dataType:'json',cache:false,processData:false,contentType:false}).done(function(response){if(response.status==='success'){if(typeof settings.success==='function'){settings.success(response,$form[0]);}}else{if(typeof settings.error==='function'){settings.error(response,$form[0]);}}}).fail(function(e){if(typeof settings.error==='function'){settings.error(e,$form[0]);}}).always(function(e){setFieldNames($form);if(e.status==='success'){sendFormEvent($form[0]);}else{sendFormEvent($form[0],'error',e);}
$form.find('[type="submit"]').prop('disabled',false).removeClass('loading');$form[0].reset();});}});};$.validator.methods.tel=function(value,element){return this.optional(element)||/^((8|7|\+7|3|\+3)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{7,10}$/.test(value);};$.validator.methods.email=function(value,element){return this.optional(element)||/^[^@]+@[^@.]+\.[^@]+$/.test(value);};$.validator.addMethod('date',function(value,element){var bits=value.match(/([0-9]+)/gi),str;if(!bits){return this.optional(element)||false;}
str=bits[1]+'/'+bits[0]+'/'+bits[2];return this.optional(element)||!/Invalid|NaN/.test(new Date(str));},'Please enter a date in the format dd/mm/yyyy');}(jQuery));function setFieldNames($form){$form.find("[data-name]").each(function(){var $this=$(this);var $name=$this.prop('name');$this.prop('name',$this.data('name'));$this.data('name',$name);});return true;}
function validateForm($name){var $form=$('form[name='+$name+']');if($form.length){$form.validateForm({success:function(response,form){if(response.status==='success'){modal.setContent('Ваше сообщение отправлено').setFooterContent(response.message).open();}else{console.error(response.message);}},error:function(response,form){console.error(response.errors);}});}}
function sendFormEvent(form,status='sent',text=''){var event=$.Event("form");event.namespace=status;event.form=form;event.name=form.getAttribute('name');event.text=text;$(document).trigger(event);}
$(function(){$(document).on('eaePopupOpen',function(e){var $form=e.popup.content.find('form');switch($form.attr('name')){case'callback_same':case'measure_type':var type=e.popup.currItem.el.data('typeName');if(type){$form.find('[name="type"]').val(type);}
break;case'aktsii':var action=e.popup.currItem.el.data('actionName');if(action){$form.find('[name="action"]').val(action);}
break;}}).on('eaePopupClose',function(e){var $form=e.popup.content.find('form');switch($form.attr('name')){case'callback_same':case'measure_type':$form.find('[name="type"]').val('');break;case'aktsii':$form.find('[name="action"]').val('');break;}});});